<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NSE Intraday Analyzer</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const TrendingUp = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const TrendingDown = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline>
                <polyline points="17 18 23 18 23 12"></polyline>
            </svg>
        );

        const AlertCircle = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );

        const RefreshCw = ({ className }) => (
            <svg className={className} width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="23 4 23 10 17 10"></polyline>
                <polyline points="1 20 1 14 7 14"></polyline>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
            </svg>
        );

        const Settings = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M12 1v6m0 6v6m9-9h-6m-6 0H3"></path>
            </svg>
        );

        const NSEIntradayAnalyzer = () => {
            const [stocks, setStocks] = useState([]);
            const [filteredStocks, setFilteredStocks] = useState([]);
            const [loading, setLoading] = useState(false);
            const [showConfig, setShowConfig] = useState(false);
            const [config, setConfig] = useState({
                apiKey: '',
                accessToken: '',
                useMockData: true
            });
            const [filters, setFilters] = useState({
                minVolume: 100000,
                minPriceChange: 1,
                maxPrice: 5000,
                minPrice: 50
            });

            const nseStocks = [
                'NSE:RELIANCE', 'NSE:TCS', 'NSE:HDFCBANK', 'NSE:INFY', 'NSE:ICICIBANK',
                'NSE:HINDUNILVR', 'NSE:ITC', 'NSE:SBIN', 'NSE:BHARTIARTL', 'NSE:KOTAKBANK',
                'NSE:LT', 'NSE:AXISBANK', 'NSE:ASIANPAINT', 'NSE:MARUTI', 'NSE:TITAN',
                'NSE:BAJFINANCE', 'NSE:WIPRO', 'NSE:ULTRACEMCO', 'NSE:ONGC', 'NSE:SUNPHARMA'
            ];

            const saveConfig = () => {
                setShowConfig(false);
                if (config.accessToken) {
                    setConfig({...config, useMockData: false});
                }
                refreshData();
            };

            const generateMockStocks = () => {
                const stockNames = [
                    'RELIANCE', 'TCS', 'HDFCBANK', 'INFY', 'ICICIBANK', 
                    'HINDUNILVR', 'ITC', 'SBIN', 'BHARTIARTL', 'KOTAKBANK',
                    'LT', 'AXISBANK', 'ASIANPAINT', 'MARUTI', 'TITAN',
                    'BAJFINANCE', 'WIPRO', 'ULTRACEMCO', 'ONGC', 'SUNPHARMA'
                ];
                
                return stockNames.map(name => {
                    const basePrice = Math.random() * 3000 + 100;
                    const changePercent = (Math.random() - 0.5) * 8;
                    const open = basePrice * (1 - changePercent/200);
                    const high = Math.max(open, basePrice) * (1 + Math.random() * 0.02);
                    const low = Math.min(open, basePrice) * (1 - Math.random() * 0.02);
                    const volume = Math.floor(Math.random() * 10000000 + 50000);
                    
                    return {
                        symbol: name,
                        price: parseFloat(basePrice.toFixed(2)),
                        open: parseFloat(open.toFixed(2)),
                        high: parseFloat(high.toFixed(2)),
                        low: parseFloat(low.toFixed(2)),
                        changePercent: parseFloat(changePercent.toFixed(2)),
                        volume: volume,
                        volatility: parseFloat((Math.random() * 3 + 0.5).toFixed(2)),
                        rsi: parseFloat((Math.random() * 100).toFixed(2))
                    };
                });
            };

            const calculateSignals = (stock) => {
                let signal = 'HOLD';
                let stopLoss = 0;
                let target = 0;
                let reason = [];

                if (stock.rsi < 30) {
                    signal = 'BUY';
                    reason.push('RSI oversold');
                    stopLoss = stock.price * 0.97;
                    target = stock.price * 1.05;
                } else if (stock.rsi > 70) {
                    signal = 'SELL';
                    reason.push('RSI overbought');
                    stopLoss = stock.price * 1.03;
                    target = stock.price * 0.95;
                }

                if (stock.changePercent > 2 && stock.volume > 500000) {
                    signal = signal === 'HOLD' ? 'BUY' : signal;
                    reason.push('Strong upward momentum');
                } else if (stock.changePercent < -2 && stock.volume > 500000) {
                    signal = signal === 'HOLD' ? 'SELL' : signal;
                    reason.push('Strong downward momentum');
                }

                if (stock.volume < 100000) {
                    signal = 'HOLD';
                    reason = ['Low volume - avoid'];
                }

                return {
                    signal,
                    stopLoss: parseFloat(stopLoss.toFixed(2)),
                    target: parseFloat(target.toFixed(2)),
                    reason: reason.join(', ') || 'Hold position'
                };
            };

            const refreshData = async () => {
                setLoading(true);
                
                await new Promise(resolve => setTimeout(resolve, 1000));
                const stockData = generateMockStocks();

                const withSignals = stockData.map(stock => ({
                    ...stock,
                    ...calculateSignals(stock)
                }));
                
                setStocks(withSignals);
                applyFilters(withSignals);
                setLoading(false);
            };

            const applyFilters = (stockData) => {
                const dataToFilter = stockData || stocks;
                const filtered = dataToFilter.filter(stock => 
                    stock.volume >= filters.minVolume &&
                    Math.abs(stock.changePercent) >= filters.minPriceChange &&
                    stock.price <= filters.maxPrice &&
                    stock.price >= filters.minPrice &&
                    stock.signal !== 'HOLD'
                );
                
                filtered.sort((a, b) => {
                    if (a.signal === 'BUY' && b.signal !== 'BUY') return -1;
                    if (a.signal !== 'BUY' && b.signal === 'BUY') return 1;
                    return Math.abs(b.changePercent) - Math.abs(a.changePercent);
                });
                
                setFilteredStocks(filtered);
            };

            useEffect(() => {
                refreshData();
                const interval = setInterval(refreshData, 120000);
                return () => clearInterval(interval);
            }, []);

            useEffect(() => {
                applyFilters();
            }, [filters]);

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 text-white p-3 md:p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                            <div>
                                <h1 className="text-2xl md:text-3xl font-bold mb-2">NSE Intraday Analyzer</h1>
                                <p className="text-slate-400 text-sm">
                                    {config.useMockData ? 'ðŸ“Š Demo Mode - Using Mock Data' : 'ðŸ”´ Live Data from Zerodha'}
                                </p>
                            </div>
                            <div className="flex gap-2">
                                <button
                                    onClick={() => setShowConfig(!showConfig)}
                                    className="flex items-center gap-2 bg-slate-700 hover:bg-slate-600 px-4 py-2 rounded-lg transition"
                                >
                                    <Settings />
                                    Config
                                </button>
                                <button
                                    onClick={refreshData}
                                    disabled={loading}
                                    className="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition disabled:opacity-50"
                                >
                                    <RefreshCw className={loading ? 'animate-spin' : ''} />
                                    Refresh
                                </button>
                            </div>
                        </div>

                        {showConfig && (
                            <div className="bg-slate-800 rounded-lg p-6 mb-6 border border-slate-700">
                                <h2 className="text-xl font-semibold mb-4">Zerodha Kite Connect Configuration</h2>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm text-slate-400 mb-2">API Key</label>
                                        <input
                                            type="text"
                                            value={config.apiKey}
                                            onChange={(e) => setConfig({...config, apiKey: e.target.value})}
                                            placeholder="Enter your Kite API Key"
                                            className="w-full bg-slate-700 rounded px-3 py-2 text-white"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm text-slate-400 mb-2">Access Token</label>
                                        <input
                                            type="text"
                                            value={config.accessToken}
                                            onChange={(e) => setConfig({...config, accessToken: e.target.value})}
                                            placeholder="Enter your Access Token"
                                            className="w-full bg-slate-700 rounded px-3 py-2 text-white"
                                        />
                                    </div>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={saveConfig}
                                            className="bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition"
                                        >
                                            Save & Connect
                                        </button>
                                        <button
                                            onClick={() => setShowConfig(false)}
                                            className="bg-slate-700 hover:bg-slate-600 px-4 py-2 rounded-lg transition"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                    <p className="text-xs text-slate-400">
                                        Note: For live data, you will need to set up a backend proxy due to CORS restrictions.
                                    </p>
                                </div>
                            </div>
                        )}

                        <div className="bg-slate-800 rounded-lg p-4 md:p-6 mb-6 border border-slate-700">
                            <h2 className="text-lg md:text-xl font-semibold mb-4">Filters</h2>
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
                                <div>
                                    <label className="block text-xs md:text-sm text-slate-400 mb-2">Min Volume</label>
                                    <input
                                        type="number"
                                        value={filters.minVolume}
                                        onChange={(e) => setFilters({...filters, minVolume: Number(e.target.value)})}
                                        className="w-full bg-slate-700 rounded px-3 py-2 text-white text-sm"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs md:text-sm text-slate-400 mb-2">Min Change (%)</label>
                                    <input
                                        type="number"
                                        step="0.5"
                                        value={filters.minPriceChange}
                                        onChange={(e) => setFilters({...filters, minPriceChange: Number(e.target.value)})}
                                        className="w-full bg-slate-700 rounded px-3 py-2 text-white text-sm"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs md:text-sm text-slate-400 mb-2">Min Price (â‚¹)</label>
                                    <input
                                        type="number"
                                        value={filters.minPrice}
                                        onChange={(e) => setFilters({...filters, minPrice: Number(e.target.value)})}
                                        className="w-full bg-slate-700 rounded px-3 py-2 text-white text-sm"
                                    />
                                </div>
                                <div>
                                    <label className="block text-xs md:text-sm text-slate-400 mb-2">Max Price (â‚¹)</label>
                                    <input
                                        type="number"
                                        value={filters.maxPrice}
                                        onChange={(e) => setFilters({...filters, maxPrice: Number(e.target.value)})}
                                        className="w-full bg-slate-700 rounded px-3 py-2 text-white text-sm"
                                    />
                                </div>
                            </div>
                        </div>

                        <div className="bg-amber-900/20 border border-amber-700 rounded-lg p-4 mb-6 flex items-start gap-3">
                            <AlertCircle />
                            <div className="text-xs md:text-sm text-amber-200">
                                <strong>Disclaimer:</strong> For educational purposes only. Not financial advice. 
                                Always conduct your own research and consult with a financial advisor before trading.
                            </div>
                        </div>

                        <div className="bg-slate-800 rounded-lg border border-slate-700 overflow-hidden">
                            <div className="overflow-x-auto">
                                <table className="w-full text-sm">
                                    <thead className="bg-slate-700">
                                        <tr>
                                            <th className="px-2 md:px-4 py-3 text-left">Symbol</th>
                                            <th className="px-2 md:px-4 py-3 text-right">Price</th>
                                            <th className="px-2 md:px-4 py-3 text-right">Change</th>
                                            <th className="hidden md:table-cell px-4 py-3 text-right">Volume</th>
                                            <th className="hidden md:table-cell px-4 py-3 text-center">RSI</th>
                                            <th className="px-2 md:px-4 py-3 text-center">Signal</th>
                                            <th className="px-2 md:px-4 py-3 text-right">Stop Loss</th>
                                            <th className="hidden lg:table-cell px-4 py-3 text-right">Target</th>
                                            <th className="hidden lg:table-cell px-4 py-3 text-left">Reason</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-700">
                                        {filteredStocks.length === 0 ? (
                                            <tr>
                                                <td colSpan="9" className="px-4 py-8 text-center text-slate-400">
                                                    {loading ? 'Loading...' : 'No stocks match the current filters.'}
                                                </td>
                                            </tr>
                                        ) : (
                                            filteredStocks.map((stock, idx) => (
                                                <tr key={idx} className="hover:bg-slate-700/50 transition">
                                                    <td className="px-2 md:px-4 py-3 font-semibold">{stock.symbol}</td>
                                                    <td className="px-2 md:px-4 py-3 text-right">â‚¹{stock.price}</td>
                                                    <td className={`px-2 md:px-4 py-3 text-right font-semibold ${
                                                        stock.changePercent > 0 ? 'text-green-400' : 'text-red-400'
                                                    }`}>
                                                        {stock.changePercent > 0 ? '+' : ''}{stock.changePercent}%
                                                    </td>
                                                    <td className="hidden md:table-cell px-4 py-3 text-right text-sm">
                                                        {(stock.volume / 1000).toFixed(0)}K
                                                    </td>
                                                    <td className="hidden md:table-cell px-4 py-3 text-center">
                                                        <span className={`px-2 py-1 rounded text-xs ${
                                                            stock.rsi < 30 ? 'bg-green-900 text-green-300' :
                                                            stock.rsi > 70 ? 'bg-red-900 text-red-300' :
                                                            'bg-slate-700 text-slate-300'
                                                        }`}>
                                                            {stock.rsi}
                                                        </span>
                                                    </td>
                                                    <td className="px-2 md:px-4 py-3 text-center">
                                                        <span className={`inline-flex items-center gap-1 px-2 md:px-3 py-1 rounded-full text-xs font-semibold ${
                                                            stock.signal === 'BUY' ? 'bg-green-900 text-green-300' :
                                                            stock.signal === 'SELL' ? 'bg-red-900 text-red-300' :
                                                            'bg-slate-700 text-slate-300'
                                                        }`}>
                                                            {stock.signal === 'BUY' && <TrendingUp />}
                                                            {stock.signal === 'SELL' && <TrendingDown />}
                                                            {stock.signal}
                                                        </span>
                                                    </td>
                                                    <td className="px-2 md:px-4 py-3 text-right text-red-400 text-xs md:text-sm">
                                                        {stock.stopLoss > 0 ? `â‚¹${stock.stopLoss}` : '-'}
                                                    </td>
                                                    <td className="hidden lg:table-cell px-4 py-3 text-right text-green-400">
                                                        {stock.target > 0 ? `â‚¹${stock.target}` : '-'}
                                                    </td>
                                                    <td className="hidden lg:table-cell px-4 py-3 text-sm text-slate-300">{stock.reason}</td>
                                                </tr>
                                            ))
                                        )}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div className="mt-6 text-center text-xs md:text-sm text-slate-400">
                            Last updated: {new Date().toLocaleTimeString('en-IN')} | 
                            Showing {filteredStocks.length} of {stocks.length} stocks
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<NSEIntradayAnalyzer />);
    </script>
</body>
</html>
